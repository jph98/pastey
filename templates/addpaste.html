<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>private pastebins</title>
<META NAME="keywords" CONTENT="pastebin, pbin, paste bin">
<META NAME="description" CONTENT="pastey paste bin">

<script src='Ractive.js'></script>
<script src='jquery-2.1.0.js'></script>

<link href="pastey.css" rel="stylesheet" type="text/css" />

<script>
        <!-- TODO: Replace this with standard Ractive events -->
        $(document).ready(function() {
            
            console.log("ready");
        });

</script>


</head>

<!-- header -->
<div id="wrapper">
<div id="header">
<a href="/"><img src="pastebin_logo.gif" border="0" alt="Pastey" title="Pastey"></a>
</div>
<!-- header -->

<body>

    <div id="error"></div>

    <div id="container">       

     <script id='tmpl' type='text/ractive'>

                <div id="content">
                        
                        <p>
                        Welcome to Pastey.  Pastey is a paste bin that allows you to upload source code and share it with other people.
                        </p>
                        <ol>
                        <li>Enter a title, choose the source code type (syntax) and enter your name.</li>
                        <li>To share the pastebin with other people send them the link in the address bar.</li></ol>

                        <form id="pasteForm" method="post" enctype="multipart/form-data" action="/pastey/index.php/addpaste">

                                <table cellpadding="0" cellspacing="0">
                                <tr><td class="label">Title <span class="mandatory">*</span></td>
                                <td class="fieldcontainer">                                        
                                        <input type="text" name="title"/>
                                        <div class="errormessage" style="display: none">
                                                Please enter a title for your pastebin
                                        </div>
                                </td></tr>

                                <tr>
                                <td class="label">Your Name <span class="mandatory">*</span></td>
                                <td class="fieldcontainer">
                                        <input type="text" name="name"/>
                                        <div class="errormessage"  style="display: none">
                                                Please enter your name
                                        </div>
                                        </td>
                                </tr>

                                <tr><td class="label">Language <span class="mandatory">*</span></td>
                                <td class="fieldcontainer" style="white-space:nowrap; padding-bottom:10px;">

                                        <select name="language">

                                            {{#languages}}
                                                <option value="{{name}}">{{name}}</option>
                                            {{/languages}}

                                            $this->data['Listing']['language']
                                        </select>

                                        <div class="errormessage"  style="display: none">
                                                Please select the code language
                                        </div></td>
                                </tr>

                                <td class="label" style="vertical-align: top; padding-top: 7px">Source Code <span class="mandatory">*</span></td>
                                <td class="fieldcontainer">
                                        <textarea name="sourcecode" rows="20" cols="100"></textarea>
                                        <div class="errormessage" style="display: none">
                                                Please the code to put in the paste bin
                                        </div>
                                </td>
                                </tr>

                        </table>

                        <p>
                            <input type="submit" name="add" class="submitButtons" on-click="addpaste" value="Add New Paste"/>
                        </p>
                        </form>
                </div>

        </div>

    	<!-- footer -->
    	<div style="clearboth"></div>

    </script>
    </div>

    <!-- Move this into a separate script -->
     <script>

        var ractive = new Ractive({
            el: 'container',
            template: '#tmpl'
        });

        request = $.ajax({
            url: "/pastey/index.php/languages",
            type: "get"
        });

        request.done(function(msg) {
             console.log("Done");
             if (msg.hasOwnProperty('error')) {
                console.log(msg.error);                    
                $("#error").html("Error: " + msg.error);
             } else {
                console.log("Success: languages");
                
                console.log(eval(msg));

                // Set the msg object on the ractive.data object
                ractive.set("languages", eval(msg))
             }

        });

        request.fail(function(jqXHR, textStatus) {
             console.log("Fail ");
             console.log(JSON.stringify(jqXHR));
             console.log(textStatus);
        });

        ractive.on( 'addpaste', function ( event ) {

            // TODO: Submit the form
            alert( 'Adding paste!' );
            $("#pasteForm").submit();
        });
        
    </script>
</body>

</html>

